+++
title = "[sttp::0x134d6f9] Branching strategy with Airflow"
slug = "adeploy"
date = 2024-01-21
draft = true
description = "how to work with airflow in medium-sized teams"
+++


2 approaches - branch per env OR trunk based development

# what

when you start a new project, its like a new year resolution, you don't want to repeat the mistakes that you did in you last project. One such thing is your branching strategy. Why?
- branching defines team collaboration
- branching defines code stability
- branching defines release management

https://www.youtube.com/watch?v=DDkjBqlks40


## gitflow

what?
- strong code isolation
- long living branches
- branches per environment

merge hell

no ci
- we are not continious integrating code; we don't constantly integrate together

lead time
- copy paste code
- new feature; new branch; more time to merge

no cd
- we can't deploy the code immediately
- we need to approve; merge; deploy

every merge is a war! we need to solve this.

## trunk based development

what?
- single point of truth
- releaseable all the time
- short living branches
- merge to trunk daily

## how to go from gitflow to trunk based

- small incremental and consistent changes. Every commit is a release. atomic release
- short living branch: 1 day
- feature flags to wrap unfinished work


**how to do this for maf**
- mindset shift
    - explain about story size
    - explain about commit size
    - explain that we need to release

- automate code reviews
    - pull request decoration

- build process improvement
    - test suite to check for issues
    - fast execution of tests


**benefit**
- low merge effort
- increase release frequency
- stable iterations; small deployments
- baby step approach for refactoring


**feature flags** - find a way how this will work for airflow
- enabling features on runtime
- decoupling deployment from release

they can go wrong
- less number of feature flags
- documented
- as high as possible
- remove when finish
- never recycle feature flags


# gitflow

setup airflow1

setup airflow2

create 2 branches on local

create cicd approach to push changes to when merge

create feature1 - dev -> test -> prod

update feature1 - dev -> test -> prod

complexities when there are multiple people working on same feature

# trunk based development

requirements - 

setup airflow 1

setup airflow 2

create main branch on local

create cicd approach to push changes to both when merging

create feature1 - dev -> test -> prod

update feature1 - dev -> test -> prod
